import{u as useAuth,j as jsxRuntimeExports}from"./index-lko4Hfbd.js";import{r as reactExports}from"./vendor-WBEadHvS.js";import{u as useChatCollaboration}from"./useChatCollaboration-D85aFU32.js";import{u as useNavigate}from"./router-BTz3HJhu.js";import"./ui-B24o0VU9.js";function ArrowLeftIcon({title,titleId,...props},svgRef){return reactExports.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:svgRef,"aria-labelledby":titleId},props),title?reactExports.createElement("title",{id:titleId},title):null,reactExports.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"}))}const ForwardRef=reactExports.forwardRef(ArrowLeftIcon),ChatCollaboration=({className="",defaultRoomId,onClose})=>{var _a;const{user}=useAuth(),[newRoomName,setNewRoomName]=reactExports.useState(""),[newRoomId,setNewRoomId]=reactExports.useState(""),[selectedRoom,setSelectedRoom]=reactExports.useState(defaultRoomId||null),[messageInput,setMessageInput]=reactExports.useState(""),[showCreateRoom,setShowCreateRoom]=reactExports.useState(!1),messagesEndRef=reactExports.useRef(null),messageInputRef=reactExports.useRef(null),typingTimeoutRef=reactExports.useRef(null),{isConnected,isConnecting,currentRoom,rooms,connectionError,connect,createRoom,joinRoom,leaveRoom,sendChatMessage,setTyping,getRoomMessages,getRoomTypingUsers,getRoomMembers}=useChatCollaboration({userId:(user==null?void 0:user.id)||"anonymous",userName:(user==null?void 0:user.name)||(user==null?void 0:user.email)||"Anonymous User",autoConnect:!0,onMessageReceived:message=>{console.log("New message:",message),setTimeout(()=>scrollToBottom(),100)},onUserJoined:user2=>{console.log("User joined:",user2)},onUserLeft:user2=>{console.log("User left:",user2)},onTypingUpdate:typingUsers2=>{console.log("Typing update:",typingUsers2)}}),scrollToBottom=()=>{var _a2;(_a2=messagesEndRef.current)==null||_a2.scrollIntoView({behavior:"smooth"})};reactExports.useEffect(()=>{scrollToBottom()},[getRoomMessages(selectedRoom||"")]);const handleCreateRoom=()=>{newRoomId.trim()&&(createRoom(newRoomId.trim(),newRoomName.trim()||void 0),setNewRoomId(""),setNewRoomName(""),setShowCreateRoom(!1))},handleJoinRoom=roomId=>{currentRoom&&leaveRoom(currentRoom),joinRoom(roomId),setSelectedRoom(roomId)},handleSendMessage=()=>{!selectedRoom||!messageInput.trim()||(sendChatMessage(selectedRoom,messageInput.trim()),setMessageInput(""),setTyping(selectedRoom,!1))},handleTyping=value=>{setMessageInput(value),selectedRoom&&(typingTimeoutRef.current&&clearTimeout(typingTimeoutRef.current),setTyping(selectedRoom,!0),typingTimeoutRef.current=setTimeout(()=>{setTyping(selectedRoom,!1)},1e3))},handleKeyPress=e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),handleSendMessage())},formatTime=timestamp=>new Date(timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),currentMessages=getRoomMessages(selectedRoom||""),typingUsers=getRoomTypingUsers(selectedRoom||""),roomMembers=getRoomMembers(selectedRoom||"");return jsxRuntimeExports.jsxs("div",{className:`flex flex-col h-full bg-white shadow-lg rounded-lg ${className}`,children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-t-lg",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx("div",{className:"w-3 h-3 rounded-full bg-green-400"}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold",children:"Itinerary Collaboration"}),jsxRuntimeExports.jsx("span",{className:"text-sm opacity-75",children:isConnected?"ðŸŸ¢ Connected":isConnecting?"ðŸŸ¡ Connecting...":"ðŸ”´ Disconnected"})]}),onClose&&jsxRuntimeExports.jsx("button",{onClick:onClose,className:"text-white hover:text-gray-200 text-xl font-bold",children:"Ã—"})]}),connectionError&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-100 border-l-4 border-red-500 text-red-700",children:jsxRuntimeExports.jsxs("div",{className:"flex",children:[jsxRuntimeExports.jsx("div",{className:"flex-1",children:jsxRuntimeExports.jsx("p",{className:"text-sm",children:connectionError})}),jsxRuntimeExports.jsx("button",{onClick:connect,className:"ml-2 text-sm bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"Reconnect"})]})}),jsxRuntimeExports.jsxs("div",{className:"flex flex-1 min-h-0",children:[jsxRuntimeExports.jsxs("div",{className:"w-1/3 border-r bg-gray-50 flex flex-col",children:[jsxRuntimeExports.jsx("div",{className:"p-3 border-b",children:jsxRuntimeExports.jsx("button",{onClick:()=>setShowCreateRoom(!showCreateRoom),className:"w-full bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600 text-sm",children:"+ Create Itinerary Room"})}),showCreateRoom&&jsxRuntimeExports.jsxs("div",{className:"p-3 border-b bg-white",children:[jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Itinerary ID (required)",value:newRoomId,onChange:e=>setNewRoomId(e.target.value),className:"w-full px-2 py-1 border rounded text-sm mb-2"}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Trip Name (optional)",value:newRoomName,onChange:e=>setNewRoomName(e.target.value),className:"w-full px-2 py-1 border rounded text-sm mb-2"}),jsxRuntimeExports.jsxs("div",{className:"flex space-x-2",children:[jsxRuntimeExports.jsx("button",{onClick:handleCreateRoom,disabled:!newRoomId.trim(),className:"flex-1 bg-green-500 text-white px-2 py-1 rounded text-sm hover:bg-green-600 disabled:bg-gray-400",children:"Create"}),jsxRuntimeExports.jsx("button",{onClick:()=>setShowCreateRoom(!1),className:"flex-1 bg-gray-500 text-white px-2 py-1 rounded text-sm hover:bg-gray-600",children:"Cancel"})]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto",children:rooms.length===0?jsxRuntimeExports.jsx("div",{className:"p-3 text-gray-500 text-sm",children:"No itinerary rooms available. Create a room to start collaborating!"}):rooms.map(room=>jsxRuntimeExports.jsxs("button",{onClick:()=>handleJoinRoom(room.room_id),className:`w-full text-left p-3 border-b hover:bg-gray-100 ${selectedRoom===room.room_id?"bg-blue-100 border-l-4 border-l-blue-500":""}`,children:[jsxRuntimeExports.jsx("div",{className:"font-medium text-sm",children:room.room_name}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-gray-500",children:[room.member_count," member",room.member_count!==1?"s":""]}),room.last_message&&jsxRuntimeExports.jsxs("div",{className:"text-xs text-gray-400 mt-1 truncate",children:[room.last_message.user_name,": ",room.last_message.message]})]},room.room_id))})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 flex flex-col",children:selectedRoom?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"p-3 border-b bg-gray-50",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-medium",children:((_a=rooms.find(r=>r.room_id===selectedRoom))==null?void 0:_a.room_name)||selectedRoom}),jsxRuntimeExports.jsxs("div",{className:"text-sm text-gray-500",children:[roomMembers.length," member",roomMembers.length!==1?"s":""," online"]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>{currentRoom&&leaveRoom(currentRoom),setSelectedRoom(null)},className:"text-gray-500 hover:text-gray-700",children:"Leave Room"})]})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-3",children:[currentMessages.map(message=>jsxRuntimeExports.jsx("div",{className:`flex ${message.user_id===((user==null?void 0:user.id)||"anonymous")?"justify-end":"justify-start"}`,children:jsxRuntimeExports.jsxs("div",{className:`max-w-xs lg:max-w-md px-3 py-2 rounded-lg ${message.user_id===((user==null?void 0:user.id)||"anonymous")?"bg-blue-500 text-white":"bg-gray-200 text-gray-800"}`,children:[message.user_id!==((user==null?void 0:user.id)||"anonymous")&&jsxRuntimeExports.jsx("div",{className:"text-xs font-medium mb-1 opacity-75",children:message.user_name}),jsxRuntimeExports.jsx("div",{className:"text-sm",children:message.message}),jsxRuntimeExports.jsx("div",{className:"text-xs opacity-75 mt-1",children:formatTime(message.timestamp)})]})},message.id)),typingUsers.length>0&&jsxRuntimeExports.jsx("div",{className:"flex justify-start",children:jsxRuntimeExports.jsxs("div",{className:"bg-gray-200 text-gray-600 px-3 py-2 rounded-lg text-sm",children:[typingUsers.map(u=>u.user_name).join(", "),typingUsers.length===1?" is":" are"," typing..."]})}),jsxRuntimeExports.jsx("div",{ref:messagesEndRef})]}),jsxRuntimeExports.jsx("div",{className:"p-3 border-t",children:jsxRuntimeExports.jsxs("div",{className:"flex space-x-2",children:[jsxRuntimeExports.jsx("input",{ref:messageInputRef,type:"text",value:messageInput,onChange:e=>handleTyping(e.target.value),onKeyPress:handleKeyPress,placeholder:"Type your message...",className:"flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:!isConnected}),jsxRuntimeExports.jsx("button",{onClick:handleSendMessage,disabled:!messageInput.trim()||!isConnected,className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 disabled:bg-gray-400",children:"Send"})]})})]}):jsxRuntimeExports.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"text-4xl mb-4",children:"ðŸ—ºï¸"}),jsxRuntimeExports.jsx("div",{className:"text-lg font-medium mb-2",children:"Welcome to Itinerary Collaboration!"}),jsxRuntimeExports.jsx("div",{className:"text-sm",children:"Create an itinerary room or join an existing one to collaborate with your travel companions."})]})})})]})]})},ChatPage=()=>{const navigate=useNavigate();return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-gray-100",children:[jsxRuntimeExports.jsx("div",{className:"bg-white shadow-sm border-b",children:jsxRuntimeExports.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between h-16",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-4",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>navigate(-1),className:"flex items-center text-gray-600 hover:text-gray-900",children:[jsxRuntimeExports.jsx(ForwardRef,{className:"h-5 w-5 mr-2"}),"Back"]}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Itinerary Collaboration"})]}),jsxRuntimeExports.jsx("div",{className:"text-sm text-gray-500",children:"Chat with collaborators while planning trips together"})]})})}),jsxRuntimeExports.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:jsxRuntimeExports.jsx("div",{className:"bg-white rounded-lg shadow h-[calc(100vh-12rem)]",children:jsxRuntimeExports.jsx(ChatCollaboration,{className:"h-full"})})})]})};export{ChatPage};
