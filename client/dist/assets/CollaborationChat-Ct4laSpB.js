import{u as useAuth,j as jsxRuntimeExports}from"./index-lko4Hfbd.js";import{r as reactExports}from"./vendor-WBEadHvS.js";import{u as useChatCollaboration}from"./useChatCollaboration-D85aFU32.js";import{_ as MessageCircle,k as Users,aE as Maximize2,aF as Minimize2,X,ac as Send}from"./ui-B24o0VU9.js";const CollaborationChat=({itineraryId,className=""})=>{const{user}=useAuth(),[isOpen,setIsOpen]=reactExports.useState(!1),[isMinimized,setIsMinimized]=reactExports.useState(!1),[messageInput,setMessageInput]=reactExports.useState(""),messagesEndRef=reactExports.useRef(null),messageInputRef=reactExports.useRef(null),typingTimeoutRef=reactExports.useRef(null),roomId=`itinerary_${itineraryId}`,roomName="Itinerary Collaboration",{isConnected,currentRoom,connectionError,joinRoom,leaveRoom,sendChatMessage,setTyping,getRoomMessages,getRoomTypingUsers,getRoomMembers}=useChatCollaboration({userId:(user==null?void 0:user.id)||"anonymous",userName:(user==null?void 0:user.name)||(user==null?void 0:user.email)||"Anonymous User",autoConnect:!0,onMessageReceived:_message=>{setTimeout(()=>scrollToBottom(),100)}}),scrollToBottom=()=>{var _a;(_a=messagesEndRef.current)==null||_a.scrollIntoView({behavior:"smooth"})};reactExports.useEffect(()=>{scrollToBottom()},[getRoomMessages(roomId)]),reactExports.useEffect(()=>{isOpen&&isConnected&&currentRoom!==roomId&&joinRoom(roomId)},[isOpen,isConnected,currentRoom,roomId,joinRoom]);const handleSendMessage=()=>{var _a;!messageInput.trim()||!currentRoom||(sendChatMessage(currentRoom,messageInput.trim()),setMessageInput(""),setTyping(currentRoom,!1),(_a=messageInputRef.current)==null||_a.focus())},handleTyping=value=>{setMessageInput(value),currentRoom&&(typingTimeoutRef.current&&clearTimeout(typingTimeoutRef.current),setTyping(currentRoom,!0),typingTimeoutRef.current=setTimeout(()=>{setTyping(currentRoom,!1)},1e3))},handleKeyPress=e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),handleSendMessage())},toggleChat=()=>{isOpen?(currentRoom&&leaveRoom(currentRoom),setIsOpen(!1)):setIsOpen(!0)},formatTime=timestamp=>new Date(timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),currentMessages=getRoomMessages(roomId),typingUsers=getRoomTypingUsers(roomId),roomMembers=getRoomMembers(roomId);return isOpen?jsxRuntimeExports.jsx("div",{className:`fixed bottom-6 right-6 z-50 ${className}`,children:jsxRuntimeExports.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 ${isMinimized?"w-80 h-12":"w-80 h-96"} transition-all duration-300`,children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-t-lg",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(MessageCircle,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("h3",{className:"font-medium text-sm",children:roomName}),roomMembers.length>0&&jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-1",children:[jsxRuntimeExports.jsx(Users,{className:"w-3 h-3"}),jsxRuntimeExports.jsx("span",{className:"text-xs",children:roomMembers.length})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-1",children:[jsxRuntimeExports.jsx("div",{className:`w-2 h-2 rounded-full ${isConnected?"bg-green-400":"bg-red-400"}`}),jsxRuntimeExports.jsx("button",{onClick:()=>setIsMinimized(!isMinimized),className:"text-white hover:text-gray-200 p-1",title:isMinimized?"Maximize":"Minimize",children:isMinimized?jsxRuntimeExports.jsx(Maximize2,{className:"w-3 h-3"}):jsxRuntimeExports.jsx(Minimize2,{className:"w-3 h-3"})}),jsxRuntimeExports.jsx("button",{onClick:toggleChat,className:"text-white hover:text-gray-200 p-1",title:"Close chat",children:jsxRuntimeExports.jsx(X,{className:"w-3 h-3"})})]})]}),!isMinimized&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[connectionError&&jsxRuntimeExports.jsxs("div",{className:"p-2 bg-red-100 border-b border-red-200 text-red-700 text-xs",children:["Connection issue: ",connectionError]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2 h-64",children:currentRoom!==roomId?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 text-sm",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(MessageCircle,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),jsxRuntimeExports.jsx("p",{children:"Joining collaboration chat..."})]})}):currentMessages.length===0?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 text-sm",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx(MessageCircle,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),jsxRuntimeExports.jsx("p",{children:"Start collaborating!"}),jsxRuntimeExports.jsx("p",{className:"text-xs mt-1",children:"Send a message to begin the conversation"})]})}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[currentMessages.map(message=>jsxRuntimeExports.jsx("div",{className:`flex ${message.user_id===((user==null?void 0:user.id)||"anonymous")?"justify-end":"justify-start"}`,children:jsxRuntimeExports.jsxs("div",{className:`max-w-xs px-3 py-2 rounded-lg ${message.user_id===((user==null?void 0:user.id)||"anonymous")?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:[message.user_id!==((user==null?void 0:user.id)||"anonymous")&&jsxRuntimeExports.jsx("div",{className:"text-xs font-medium mb-1 opacity-75",children:message.user_name}),jsxRuntimeExports.jsx("div",{className:"text-sm",children:message.message}),jsxRuntimeExports.jsx("div",{className:"text-xs opacity-75 mt-1",children:formatTime(message.timestamp)})]})},message.id)),typingUsers.length>0&&jsxRuntimeExports.jsx("div",{className:"flex justify-start",children:jsxRuntimeExports.jsxs("div",{className:"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-3 py-2 rounded-lg text-sm",children:[typingUsers.map(u=>u.user_name).join(", "),typingUsers.length===1?" is":" are"," typing..."]})}),jsxRuntimeExports.jsx("div",{ref:messagesEndRef})]})}),jsxRuntimeExports.jsx("div",{className:"p-3 border-t border-gray-200 dark:border-gray-700",children:jsxRuntimeExports.jsxs("div",{className:"flex space-x-2",children:[jsxRuntimeExports.jsx("input",{ref:messageInputRef,type:"text",value:messageInput,onChange:e=>handleTyping(e.target.value),onKeyPress:handleKeyPress,placeholder:"Type a message...",className:"flex-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",disabled:!isConnected||currentRoom!==roomId}),jsxRuntimeExports.jsx("button",{onClick:handleSendMessage,disabled:!messageInput.trim()||!isConnected||currentRoom!==roomId,className:"bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",title:"Send message",children:jsxRuntimeExports.jsx(Send,{className:"w-4 h-4"})})]})})]})]})}):jsxRuntimeExports.jsx("div",{className:`fixed bottom-6 right-6 z-50 ${className}`,children:jsxRuntimeExports.jsxs("button",{onClick:toggleChat,className:"flex items-center justify-center w-14 h-14 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg transition-all duration-300 hover:scale-110",title:"Open collaboration chat",children:[jsxRuntimeExports.jsx(MessageCircle,{className:"w-6 h-6"}),currentMessages.length>0&&jsxRuntimeExports.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full border-2 border-white flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-white",children:currentMessages.length})})]})})};export{CollaborationChat as C};
